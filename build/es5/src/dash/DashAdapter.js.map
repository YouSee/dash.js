{"version":3,"sources":["../../../../src/dash/DashAdapter.js"],"names":["DashAdapter","instance","dashManifestModel","voPeriods","voAdaptations","currentMediaInfo","setup","reset","setConfig","config","getRepresentationForRepresentationInfo","representationInfo","representationController","getRepresentationForQuality","quality","getAdaptationForMediaInfo","mediaInfo","streamInfo","id","undefined","index","getPeriodForStreamInfo","voPeriodsArray","ln","length","i","voPeriod","convertRepresentationToRepresentationInfo","voRepresentation","RepresentationInfo","realAdaptation","adaptation","period","mpd","manifest","Period_asArray","AdaptationSet_asArray","realRepresentation","getRepresentationFor","bandwidth","getBandwidth","DVRWindow","segmentAvailabilityRange","fragmentDuration","segmentDuration","segments","duration","NaN","MSETimeOffset","useCalculatedLiveEdgeTime","convertAdaptationToMediaInfo","MediaInfo","viewpoint","type","convertPeriodToStreamInfo","representationCount","getRepresentationCount","lang","getLanguageForAdaptation","getViewpointForAdaptation","value","accessibility","getAccessibilityForAdaptation","map","accessibilityValue","accessibilityData","schemeIdUri","search","cea608parser","embeddedCaptions","audioChannelConfiguration","getAudioChannelConfigurationForAdaptation","roles","getRolesForAdaptation","role","codec","getCodec","mimeType","getMimeType","contentProtection","getContentProtectionData","bitrateList","getBitrateListForAdaptation","forEach","item","KID","getKID","isText","getIsTextTrack","convertVideoInfoToEmbeddedTextInfo","channel","parseInt","substring","Constants","EMBEDDED_TEXT","isEmbedded","convertVideoInfoToThumbnailInfo","IMAGE","StreamInfo","THRESHOLD","start","manifestInfo","convertMpdToManifestInfo","isLast","Math","abs","ManifestInfo","DVRWindowSize","timeShiftBufferDepth","loadedTime","availableFrom","availabilityStartTime","minBufferTime","maxFragmentDuration","maxSegmentDuration","getDuration","isDynamic","getIsDynamic","getMediaInfoForType","getAdaptationForType","selectedVoPeriod","periodId","idx","getIndexForAdaptation","getAdaptationsForPeriod","getIsMain","filter","DashConstants","MAIN","periodIndex","adaptations","getAdaptationsForType","allMediaInfoForType","getAllMediaInfoForType","isMediaInfoEqual","externalManifest","voLocalPeriods","mediaArr","data","media","j","checkSetConfigCall","getMpd","getRegularPeriods","adaptationsForType","VIDEO","accessibilityLength","indexOf","parts","split","call","push","CC1","hasOwnProperty","Error","updatePeriods","newManifest","getStreamsInfo","maxStreamsInfo","streams","checkStreamProcessor","streamProcessor","checkRepresentationController","getInitRequest","representation","indexHandler","getRepresentationController","getIndexHandler","getFragmentRequest","time","options","fragRequest","getSegmentRequestForTime","getNextSegmentRequest","getIndexHandlerTime","getCurrentTime","setIndexHandlerTime","setCurrentTime","resetIndexHandler","resetIndex","updateData","getStreamInfo","getMediaInfo","voAdaptation","getType","getAdaptationForId","getAdaptationForIndex","getRepresentationInfo","getCurrentRepresentation","getEvent","eventBox","eventStreams","startTime","event","Event","scheme_id_uri","timescale","presentationTimeDelta","presentation_time_delta","event_duration","messageData","message_data","presentationTime","eventStream","getEventsFor","info","events","getEventsForPeriod","getEventStreamForAdaptationSet","getEventStreamForRepresentation","setCurrentMediaInfo","streamId","convertDataToRepresentationInfo","getDataForMedia","__dashjs_factory_name","FactoryMaker","getSingletonFactory"],"mappings":"sEA+BA,2D,mDACA,wD,2DACA,sE,qEACA,oD,mDACA,sD,qDACA,0D,yDACA,iC,2CACA,kD,yDACA,2D,yDACA,mE,mFAxCA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GA0CA,QAASA,YAAT,EAAuB,CACnB,GAAIC,gBAAJ,CACIC,wBADJ,CAEIC,gBAFJ,CAGIC,oBAHJ,CAIIC,uBAJJ,CAMA,QAASC,MAAT,EAAiB,CACbC,QACH,CAED,QAASC,UAAT,CAAmBC,MAAnB,CAA2B,CACvB,GAAI,CAACA,MAAL,CAAa,OAEb,GAAIA,OAAOP,iBAAX,CAA8B,CAC1BA,kBAAoBO,OAAOP,iBAA3B,CACH,CACJ,CAED,QAASQ,uCAAT,CAAgDC,kBAAhD,CAAoEC,wBAApE,CAA8F,CAC1F,MAAOA,2BAA4BD,kBAA5B,CAAiDC,yBAAyBC,2BAAzB,CAAqDF,mBAAmBG,OAAxE,CAAjD,CAAoI,IAA3I,CACH,CAED,QAASC,0BAAT,CAAmCC,SAAnC,CAA8C,CAE1C,GAAI,CAACA,SAAD,EAAc,CAACA,UAAUC,UAAzB,EAAuCD,UAAUC,UAAV,CAAqBC,EAArB,GAA4BC,SAAnE,EAAgF,CAACf,cAAcY,UAAUC,UAAV,CAAqBC,EAAnC,CAArF,CAA6H,MAAO,KAAP,CAC7H,MAAOd,eAAcY,UAAUC,UAAV,CAAqBC,EAAnC,EAAuCF,UAAUI,KAAjD,CAAP,CACH,CAED,QAASC,uBAAT,CAAgCJ,UAAhC,CAA4CK,cAA5C,CAA4D,CACxD,GAAMC,IAAKD,eAAeE,MAA1B,CAEA,IAAK,GAAIC,GAAI,CAAb,CAAgBA,EAAIF,EAApB,CAAwBE,GAAxB,CAA6B,CACzB,GAAIC,UAAWJ,eAAeG,CAAf,CAAf,CAEA,GAAIR,WAAWC,EAAX,GAAkBQ,SAASR,EAA/B,CAAmC,MAAOQ,SAAP,CACtC,CAED,MAAO,KAAP,CACH,CAED,QAASC,0CAAT,CAAmDC,gBAAnD,CAAqE,CACjE,GAAIjB,oBAAqB,GAAIkB,6BAAJ,EAAzB,CACA,GAAMC,gBAAiBF,iBAAiBG,UAAjB,CAA4BC,MAA5B,CAAmCC,GAAnC,CAAuCC,QAAvC,CAAgDC,cAAhD,CAA+DP,iBAAiBG,UAAjB,CAA4BC,MAA5B,CAAmCZ,KAAlG,EAAyGgB,qBAAzG,CAA+HR,iBAAiBG,UAAjB,CAA4BX,KAA3J,CAAvB,CACA,GAAMiB,oBAAqBnC,kBAAkBoC,oBAAlB,CAAuCV,iBAAiBR,KAAxD,CAA+DU,cAA/D,CAA3B,CAEAnB,mBAAmBO,EAAnB,CAAwBU,iBAAiBV,EAAzC,CACAP,mBAAmBG,OAAnB,CAA6Bc,iBAAiBR,KAA9C,CACAT,mBAAmB4B,SAAnB,CAA+BrC,kBAAkBsC,YAAlB,CAA+BH,kBAA/B,CAA/B,CACA1B,mBAAmB8B,SAAnB,CAA+Bb,iBAAiBc,wBAAhD,CACA/B,mBAAmBgC,gBAAnB,CAAsCf,iBAAiBgB,eAAjB,GAAqChB,iBAAiBiB,QAAjB,EAA6BjB,iBAAiBiB,QAAjB,CAA0BrB,MAA1B,CAAmC,CAAhE,CAAoEI,iBAAiBiB,QAAjB,CAA0B,CAA1B,EAA6BC,QAAjG,CAA4GC,GAAjJ,CAAtC,CACApC,mBAAmBqC,aAAnB,CAAmCpB,iBAAiBoB,aAApD,CACArC,mBAAmBsC,yBAAnB,CAA+CrB,iBAAiBqB,yBAAhE,CACAtC,mBAAmBK,SAAnB,CAA+BkC,6BAA6BtB,iBAAiBG,UAA9C,CAA/B,CAEA,MAAOpB,mBAAP,CACH,CAED,QAASuC,6BAAT,CAAsCnB,UAAtC,CAAkD,CAC9C,GAAIf,WAAY,GAAImC,oBAAJ,EAAhB,CACA,GAAMrB,gBAAiBC,WAAWC,MAAX,CAAkBC,GAAlB,CAAsBC,QAAtB,CAA+BC,cAA/B,CAA8CJ,WAAWC,MAAX,CAAkBZ,KAAhE,EAAuEgB,qBAAvE,CAA6FL,WAAWX,KAAxG,CAAvB,CACA,GAAIgC,iBAAJ,CAEApC,UAAUE,EAAV,CAAea,WAAWb,EAA1B,CACAF,UAAUI,KAAV,CAAkBW,WAAWX,KAA7B,CACAJ,UAAUqC,IAAV,CAAiBtB,WAAWsB,IAA5B,CACArC,UAAUC,UAAV,CAAuBqC,0BAA0BvB,WAAWC,MAArC,CAAvB,CACAhB,UAAUuC,mBAAV,CAAgCrD,kBAAkBsD,sBAAlB,CAAyC1B,cAAzC,CAAhC,CACAd,UAAUyC,IAAV,CAAiBvD,kBAAkBwD,wBAAlB,CAA2C5B,cAA3C,CAAjB,CACAsB,UAAYlD,kBAAkByD,yBAAlB,CAA4C7B,cAA5C,CAAZ,CACAd,UAAUoC,SAAV,CAAsBA,UAAYA,UAAUQ,KAAtB,CAA8BzC,SAApD,CACAH,UAAU6C,aAAV,CAA0B3D,kBAAkB4D,6BAAlB,CAAgDhC,cAAhD,EAAgEiC,GAAhE,CAAoE,SAAUF,aAAV,CAAyB,CACnH,GAAIG,oBAAqBH,cAAcD,KAAvC,CACA,GAAIK,mBAAoBD,kBAAxB,CACA,GAAIH,cAAcK,WAAd,EAA8BL,cAAcK,WAAd,CAA0BC,MAA1B,CAAiC,SAAjC,GAA+C,CAA7E,EAAmF,MAAQC,uBAAR,GAA0B,WAAjH,CAA8H,CAC1H,GAAIJ,kBAAJ,CAAwB,CACpBC,kBAAoB,WAAaD,kBAAjC,CACH,CAFD,IAEO,CACHC,kBAAoB,SAApB,CACH,CACDjD,UAAUqD,gBAAV,CAA6B,IAA7B,CACH,CACD,MAAOJ,kBAAP,CACH,CAZyB,CAA1B,CAcAjD,UAAUsD,yBAAV,CAAsCpE,kBAAkBqE,yCAAlB,CAA4DzC,cAA5D,EAA4EiC,GAA5E,CAAgF,SAAUO,yBAAV,CAAqC,CACvJ,MAAOA,2BAA0BV,KAAjC,CACH,CAFqC,CAAtC,CAGA5C,UAAUwD,KAAV,CAAkBtE,kBAAkBuE,qBAAlB,CAAwC3C,cAAxC,EAAwDiC,GAAxD,CAA4D,SAAUW,IAAV,CAAgB,CAC1F,MAAOA,MAAKd,KAAZ,CACH,CAFiB,CAAlB,CAGA5C,UAAU2D,KAAV,CAAkBzE,kBAAkB0E,QAAlB,CAA2B9C,cAA3B,CAAlB,CACAd,UAAU6D,QAAV,CAAqB3E,kBAAkB4E,WAAlB,CAA8BhD,cAA9B,CAArB,CACAd,UAAU+D,iBAAV,CAA8B7E,kBAAkB8E,wBAAlB,CAA2ClD,cAA3C,CAA9B,CACAd,UAAUiE,WAAV,CAAwB/E,kBAAkBgF,2BAAlB,CAA8CpD,cAA9C,CAAxB,CAEA,GAAId,UAAU+D,iBAAd,CAAiC,CAC7B/D,UAAU+D,iBAAV,CAA4BI,OAA5B,CAAoC,SAAUC,IAAV,CAAgB,CAChDA,KAAKC,GAAL,CAAWnF,kBAAkBoF,MAAlB,CAAyBF,IAAzB,CAAX,CACH,CAFD,EAGH,CAEDpE,UAAUuE,MAAV,CAAmBrF,kBAAkBsF,cAAlB,CAAiCxE,UAAU6D,QAA3C,CAAnB,CAEA,MAAO7D,UAAP,CACH,CAED,QAASyE,mCAAT,CAA4CzE,SAA5C,CAAuD0E,OAAvD,CAAgEjC,IAAhE,CAAsE,CAClEzC,UAAUE,EAAV,CAAewE,OAAf,CAAwB;AACxB1E,UAAUI,KAAV,CAAkB,IAAMuE,SAASD,QAAQE,SAAR,CAAkB,CAAlB,CAAqB,CAArB,CAAT,CAAxB,CACA5E,UAAUqC,IAAV,CAAiBwC,oBAAUC,aAA3B,CACA9E,UAAU2D,KAAV,CAAkB,gBAAlB,CACA3D,UAAUuE,MAAV,CAAmB,IAAnB,CACAvE,UAAU+E,UAAV,CAAuB,IAAvB,CACA/E,UAAUyC,IAAV,CAAiBA,IAAjB,CACAzC,UAAUwD,KAAV,CAAkB,CAAC,SAAD,CAAlB,CACH,CAED,QAASwB,gCAAT,CAAyChF,SAAzC,CAAoD,CAChDA,UAAUqC,IAAV,CAAiBwC,oBAAUI,KAA3B,CACH,CAED,QAAS3C,0BAAT,CAAmCtB,MAAnC,CAA2C,CACvC,GAAIf,YAAa,GAAIiF,qBAAJ,EAAjB,CACA,GAAMC,WAAY,CAAlB,CAEAlF,WAAWC,EAAX,CAAgBc,OAAOd,EAAvB,CACAD,WAAWG,KAAX,CAAmBY,OAAOZ,KAA1B,CACAH,WAAWmF,KAAX,CAAmBpE,OAAOoE,KAA1B,CACAnF,WAAW6B,QAAX,CAAsBd,OAAOc,QAA7B,CACA7B,WAAWoF,YAAX,CAA0BC,yBAAyBtE,OAAOC,GAAhC,CAA1B,CACAhB,WAAWsF,MAAX,CAAoBvE,OAAOC,GAAP,CAAWC,QAAX,CAAoBC,cAApB,CAAmCX,MAAnC,GAA8C,CAA9C,EAAmDgF,KAAKC,GAAL,CAAUxF,WAAWmF,KAAX,CAAmBnF,WAAW6B,QAA/B,CAA2C7B,WAAWoF,YAAX,CAAwBvD,QAA5E,EAAwFqD,SAA/J,CAEA,MAAOlF,WAAP,CACH,CAED,QAASqF,yBAAT,CAAkCrE,GAAlC,CAAuC,CACnC,GAAIoE,cAAe,GAAIK,uBAAJ,EAAnB,CAEAL,aAAaM,aAAb,CAA6B1E,IAAI2E,oBAAjC,CACAP,aAAaQ,UAAb,CAA0B5E,IAAIC,QAAJ,CAAa2E,UAAvC,CACAR,aAAaS,aAAb,CAA6B7E,IAAI8E,qBAAjC,CACAV,aAAaW,aAAb,CAA6B/E,IAAIC,QAAJ,CAAa8E,aAA1C,CACAX,aAAaY,mBAAb,CAAmChF,IAAIiF,kBAAvC,CACAb,aAAavD,QAAb,CAAwB5C,kBAAkBiH,WAAlB,CAA8BlF,IAAIC,QAAlC,CAAxB,CACAmE,aAAae,SAAb,CAAyBlH,kBAAkBmH,YAAlB,CAA+BpF,IAAIC,QAAnC,CAAzB,CAEA,MAAOmE,aAAP,CACH,CAED,QAASiB,oBAAT,CAA6BrG,UAA7B,CAAyCoC,IAAzC,CAA+C,CAE3C,GAAIlD,UAAUqB,MAAV,GAAqB,CAAzB,CAA4B,CACxB,MAAO,KAAP,CACH,CAED,GAAMU,UAAW/B,UAAU,CAAV,EAAa8B,GAAb,CAAiBC,QAAlC,CACA,GAAIJ,gBAAiByF,qBAAqBrF,QAArB,CAA+BjB,WAAWG,KAA1C,CAAiDiC,IAAjD,CAAuDpC,UAAvD,CAArB,CACA,GAAI,CAACa,cAAL,CAAqB,MAAO,KAAP,CAErB,GAAI0F,kBAAmBnG,uBAAuBJ,UAAvB,CAAmCd,SAAnC,CAAvB,CACA,GAAIsH,UAAWD,iBAAiBtG,EAAhC,CACA,GAAIwG,KAAMxH,kBAAkByH,qBAAlB,CAAwC7F,cAAxC,CAAwDI,QAAxD,CAAkEjB,WAAWG,KAA7E,CAAV,CAEAhB,cAAcqH,QAAd,EAA0BrH,cAAcqH,QAAd,GAA2BvH,kBAAkB0H,uBAAlB,CAA0CJ,gBAA1C,CAArD,CAEA,MAAOtE,8BAA6B9C,cAAcqH,QAAd,EAAwBC,GAAxB,CAA7B,CAAP,CACH,CAED,QAASG,UAAT,CAAmB9F,UAAnB,CAA+B,CAC3B,MAAO7B,mBAAkBuE,qBAAlB,CAAwC1C,UAAxC,EAAoD+F,MAApD,CAA2D,SAAUpD,IAAV,CAAgB,CAC9E,MAAOA,MAAKd,KAAL,GAAemE,wBAAcC,IAApC,CACH,CAFM,EAEJ,CAFI,CAAP,CAGH,CAED,QAAST,qBAAT,CAA8BrF,QAA9B,CAAwC+F,WAAxC,CAAqD5E,IAArD,CAA2DpC,UAA3D,CAAuE,CACnE,GAAMiH,aAAchI,kBAAkBiI,qBAAlB,CAAwCjG,QAAxC,CAAkD+F,WAAlD,CAA+D5E,IAA/D,CAApB,CAEA,GAAI,CAAC6E,WAAD,EAAgBA,YAAY1G,MAAZ,GAAuB,CAA3C,CAA8C,MAAO,KAAP,CAE9C,GAAI0G,YAAY1G,MAAZ,CAAqB,CAArB,EAA0BP,UAA9B,CAA0C,CACtC,GAAMmH,qBAAsBC,uBAAuBpH,UAAvB,CAAmCoC,IAAnC,CAA5B,CAEA,GAAIhD,iBAAiBY,WAAWC,EAA5B,GAAmCb,iBAAiBY,WAAWC,EAA5B,EAAgCmC,IAAhC,CAAvC,CAA8E,CAC1E,IAAK,GAAI5B,GAAI,CAAR,CAAWF,GAAK2G,YAAY1G,MAAjC,CAAyCC,EAAIF,EAA7C,CAAiDE,GAAjD,CAAsD,CAClD,GAAIpB,iBAAiBY,WAAWC,EAA5B,EAAgCmC,IAAhC,EAAsCiF,gBAAtC,CAAuDF,oBAAoB3G,CAApB,CAAvD,CAAJ,CAAoF,CAChF,MAAOyG,aAAYzG,CAAZ,CAAP,CACH,CACJ,CACJ,CAED,IAAK,GAAIA,IAAI,CAAR,CAAWF,IAAK2G,YAAY1G,MAAjC,CAAyCC,GAAIF,GAA7C,CAAiDE,IAAjD,CAAsD,CAClD,GAAIoG,UAAUK,YAAYzG,EAAZ,CAAV,CAAJ,CAA+B,CAC3B,MAAOyG,aAAYzG,EAAZ,CAAP,CACH,CACJ,CACJ,CAED,MAAOyG,aAAY,CAAZ,CAAP,CACH,CAED,QAASG,uBAAT,CAAgCpH,UAAhC,CAA4CoC,IAA5C,CAAkDkF,gBAAlD,CAAoE,CAChE,GAAIC,gBAAiBrI,SAArB,CACA,GAAI+B,UAAWqG,gBAAf,CACA,GAAIE,UAAW,EAAf,CACA,GAAIC,YAAJ,CACIC,YADJ,CAEIjB,UAFJ,CAGIjG,QAHJ,CAIImH,QAJJ,CAKIrH,SALJ,CAOA,GAAIW,QAAJ,CAAc,CACV2G,qBACA,GAAM5G,KAAM/B,kBAAkB4I,MAAlB,CAAyB5G,QAAzB,CAAZ,CAEAsG,eAAiBtI,kBAAkB6I,iBAAlB,CAAoC9G,GAApC,CAAjB,CACH,CALD,IAKO,CACH,GAAI9B,UAAUqB,MAAV,CAAmB,CAAvB,CAA0B,CACtBU,SAAW/B,UAAU,CAAV,EAAa8B,GAAb,CAAiBC,QAA5B,CACH,CAFD,IAEO,CACH,MAAOuG,SAAP,CACH,CACJ,CAED,GAAMjB,kBAAmBnG,uBAAuBJ,UAAvB,CAAmCuH,cAAnC,CAAzB,CACA,GAAMf,UAAWD,iBAAiBtG,EAAlC,CACA,GAAM8H,oBAAqB9I,kBAAkBiI,qBAAlB,CAAwCjG,QAAxC,CAAkDjB,WAAWG,KAA7D,CAAoEiC,OAASwC,oBAAUC,aAAnB,CAAmCzC,IAAnC,CAA0CwC,oBAAUoD,KAAxH,CAA3B,CAEA,GAAI,CAACD,kBAAL,CAAyB,MAAOP,SAAP,CAEzBrI,cAAcqH,QAAd,EAA0BrH,cAAcqH,QAAd,GAA2BvH,kBAAkB0H,uBAAlB,CAA0CJ,gBAA1C,CAArD,CAEA,IAAK/F,EAAI,CAAJ,CAAOF,GAAKyH,mBAAmBxH,MAApC,CAA4CC,EAAIF,EAAhD,CAAoDE,GAApD,CAAyD,CACrDiH,KAAOM,mBAAmBvH,CAAnB,CAAP,CACAiG,IAAMxH,kBAAkByH,qBAAlB,CAAwCe,IAAxC,CAA8CxG,QAA9C,CAAwDjB,WAAWG,KAAnE,CAAN,CACAuH,MAAQzF,6BAA6B9C,cAAcqH,QAAd,EAAwBC,GAAxB,CAA7B,CAAR,CAEA,GAAIrE,OAASwC,oBAAUC,aAAvB,CAAsC,CAClC,GAAIoD,qBAAsBP,MAAM9E,aAAN,CAAoBrC,MAA9C,CACA,IAAKoH,EAAI,CAAT,CAAYA,EAAIM,mBAAhB,CAAqCN,GAArC,CAA0C,CACtC,GAAI,CAACD,KAAL,CAAY,CACR,SACH,CACD,GAAI9E,eAAgB8E,MAAM9E,aAAN,CAAoB+E,CAApB,CAApB,CACA,GAAI/E,cAAcsF,OAAd,CAAsB,UAAtB,IAAsC,CAA1C,CAA6C,CACzC,GAAIvF,OAAQC,cAAc+B,SAAd,CAAwB,CAAxB,CAAZ,CACA,GAAIwD,OAAQxF,MAAMyF,KAAN,CAAY,GAAZ,CAAZ,CACA,GAAID,MAAM,CAAN,EAASxD,SAAT,CAAmB,CAAnB,CAAsB,CAAtB,IAA6B,IAAjC,CAAuC,CACnC,IAAKgD,EAAI,CAAT,CAAYA,EAAIQ,MAAM5H,MAAtB,CAA8BoH,GAA9B,CAAmC,CAC/B,GAAI,CAACD,KAAL,CAAY,CACRA,MAAQzF,6BAA6BoG,IAA7B,CAAkC,IAAlC,CAAwClJ,cAAcqH,QAAd,EAAwBC,GAAxB,CAAxC,CAAR,CACH,CACDjC,mCAAmCkD,KAAnC,CAA0CS,MAAMR,CAAN,EAAShD,SAAT,CAAmB,CAAnB,CAAsB,CAAtB,CAA1C,CAAoEwD,MAAMR,CAAN,EAAShD,SAAT,CAAmB,CAAnB,CAApE,EACA6C,SAASc,IAAT,CAAcZ,KAAd,EACAA,MAAQ,IAAR,CACH,CACJ,CATD,IASO,CACH,IAAKC,EAAI,CAAT,CAAYA,EAAIQ,MAAM5H,MAAtB,CAA8BoH,GAA9B,CAAmC,CAAE;AACjC,GAAI,CAACD,KAAL,CAAY,CACRA,MAAQzF,6BAA6BoG,IAA7B,CAAkC,IAAlC,CAAwClJ,cAAcqH,QAAd,EAAwBC,GAAxB,CAAxC,CAAR,CACH,CACDjC,mCAAmCkD,KAAnC,CAA0C,MAAQC,EAAI,CAAZ,CAA1C,CAA0DQ,MAAMR,CAAN,CAA1D,EACAH,SAASc,IAAT,CAAcZ,KAAd,EACAA,MAAQ,IAAR,CACH,CACJ,CACJ,CAtBD,IAsBO,IAAI9E,cAAcsF,OAAd,CAAsB,SAAtB,IAAqC,CAAzC,CAA4C,CAAE;AACjD1D,mCAAmCkD,KAAnC,CAA0C9C,oBAAU2D,GAApD,CAAyD,KAAzD,EACAf,SAASc,IAAT,CAAcZ,KAAd,EACAA,MAAQ,IAAR,CACH,CACJ,CACJ,CAnCD,IAmCO,IAAItF,OAASwC,oBAAUI,KAAvB,CAA8B,CACjCD,gCAAgC2C,KAAhC,EACAF,SAASc,IAAT,CAAcZ,KAAd,EACAA,MAAQ,IAAR,CACH,CAJM,IAIA,IAAIA,KAAJ,CAAW,CACdF,SAASc,IAAT,CAAcZ,KAAd,EACH,CACJ,CAED,MAAOF,SAAP,CACH,CAED,QAASI,mBAAT,EAA8B,CAC1B,GAAI,CAAC3I,iBAAD,EAAsB,CAACA,kBAAkBuJ,cAAlB,CAAiC,QAAjC,CAAvB,EAAqE,CAACvJ,kBAAkBuJ,cAAlB,CAAiC,mBAAjC,CAA1E,CAAiI,CAC7H,KAAM,IAAIC,MAAJ,CAAU,gDAAV,CAAN,CACH,CACJ,CAED,QAASC,cAAT,CAAuBC,WAAvB,CAAoC,CAChC,GAAI,CAACA,WAAL,CAAkB,MAAO,KAAP,CAElBf,qBAEA,GAAM5G,KAAM/B,kBAAkB4I,MAAlB,CAAyBc,WAAzB,CAAZ,CAEAzJ,UAAYD,kBAAkB6I,iBAAlB,CAAoC9G,GAApC,CAAZ,CACA7B,cAAgB,EAAhB,CACH,CAED,QAASyJ,eAAT,CAAwBtB,gBAAxB,CAA0CuB,cAA1C,CAA0D,CACtD,GAAMC,SAAU,EAAhB,CACA,GAAIvB,gBAAiBrI,SAArB,CAEA;AACA,GAAIoI,gBAAJ,CAAsB,CAClBM,qBACA,GAAM5G,KAAM/B,kBAAkB4I,MAAlB,CAAyBP,gBAAzB,CAAZ,CAEAC,eAAiBtI,kBAAkB6I,iBAAlB,CAAoC9G,GAApC,CAAjB,CACH,CAED,GAAI,CAAC6H,cAAL,CAAqB,CACjBA,eAAiBtB,eAAehH,MAAhC,CACH,CACD,IAAK,GAAIC,GAAI,CAAb,CAAgBA,EAAIqI,cAApB,CAAoCrI,GAApC,CAAyC,CACrCsI,QAAQR,IAAR,CAAajG,0BAA0BkF,eAAe/G,CAAf,CAA1B,CAAb,EACH,CAED,MAAOsI,QAAP,CACH,CAED,QAASC,qBAAT,CAA8BC,eAA9B,CAA+C,CAC3C,GAAI,CAACA,eAAD,EAAoB,CAACA,gBAAgBR,cAAhB,CAA+B,6BAA/B,CAArB,EAAsF,CAACQ,gBAAgBR,cAAhB,CAA+B,iBAA/B,CAAvF,EACA,CAACQ,gBAAgBR,cAAhB,CAA+B,cAA/B,CADD,EACmD,CAACQ,gBAAgBR,cAAhB,CAA+B,SAA/B,CADpD,EACiG,CAACQ,gBAAgBR,cAAhB,CAA+B,eAA/B,CADtG,CACuJ,CACnJ,KAAM,IAAIC,MAAJ,CAAU,oDAAV,CAAN,CACH,CACJ,CAED,QAASQ,8BAAT,CAAuCtJ,wBAAvC,CAAiE,CAC7D,GAAI,CAACA,wBAAD,EAA6B,CAACA,yBAAyB6I,cAAzB,CAAwC,6BAAxC,CAA9B,EAAwG,CAAC7I,yBAAyB6I,cAAzB,CAAwC,0BAAxC,CAA7G,CAAkL,CAC9K,KAAM,IAAIC,MAAJ,CAAU,6DAAV,CAAN,CACH,CACJ,CAED,QAASS,eAAT,CAAwBF,eAAxB,CAAyCnJ,OAAzC,CAAkD,CAC9C,GAAIF,gCAAJ,CACIwJ,qBADJ,CAEIC,mBAFJ,CAIAL,qBAAqBC,eAArB,EACA,kCAAanJ,OAAb,EAEAF,yBAA2BqJ,gBAAgBK,2BAAhB,EAA3B,CACAD,aAAeJ,gBAAgBM,eAAhB,EAAf,CAEAH,eAAiBxJ,yBAA2BA,yBAAyBC,2BAAzB,CAAqDC,OAArD,CAA3B,CAA2F,IAA5G,CAEA,MAAOuJ,cAAeA,aAAaF,cAAb,CAA4BC,cAA5B,CAAf,CAA6D,IAApE,CACH,CAED,QAASI,mBAAT,CAA4BP,eAA5B,CAA6CtJ,kBAA7C,CAAiE8J,IAAjE,CAAuEC,OAAvE,CAAgF,CAC5E,GAAI9J,gCAAJ,CACIwJ,qBADJ,CAEIC,mBAFJ,CAIA,GAAIM,aAAc,IAAlB,CAEAX,qBAAqBC,eAArB,EAEArJ,yBAA2BqJ,gBAAgBK,2BAAhB,EAA3B,CACAF,eAAiB1J,uCAAuCC,kBAAvC,CAA2DC,wBAA3D,CAAjB,CACAyJ,aAAeJ,gBAAgBM,eAAhB,EAAf,CAEA,GAAIF,YAAJ,CAAkB,CACd;AACA;AACA,GAAII,OAAStJ,SAAT,EAAsBuJ,UAAYvJ,SAAtC,CAAiD,CAC7CwJ,YAAcN,aAAaO,wBAAb,CAAsCR,cAAtC,CAAsDK,IAAtD,CAA4DC,OAA5D,CAAd,CACH,CAFD,IAEO,CACHC,YAAcN,aAAaQ,qBAAb,CAAmCT,cAAnC,CAAd,CACH,CACJ,CAED,MAAOO,YAAP,CACH,CAED,QAASG,oBAAT,CAA6Bb,eAA7B,CAA8C,CAC1CD,qBAAqBC,eAArB,EAEA,GAAMI,cAAeJ,gBAAgBM,eAAhB,EAArB,CAEA,MAAOF,cAAeA,aAAaU,cAAb,EAAf,CAA+ChI,GAAtD,CACH,CAED,QAASiI,oBAAT,CAA6Bf,eAA7B,CAA8CrG,KAA9C,CAAqD,CACjDoG,qBAAqBC,eAArB,EAEA,GAAMI,cAAeJ,gBAAgBM,eAAhB,EAArB,CACA,GAAIF,YAAJ,CAAkB,CACdA,aAAaY,cAAb,CAA4BrH,KAA5B,EACH,CACJ,CAED,QAASsH,kBAAT,CAA2BjB,eAA3B,CAA4C,CACxCD,qBAAqBC,eAArB,EAEA,GAAMI,cAAeJ,gBAAgBM,eAAhB,EAArB,CACA,GAAIF,YAAJ,CAAkB,CACdA,aAAac,UAAb,GACH,CACJ,CAED,QAASC,WAAT,CAAoBnB,eAApB,CAAqC,CACjCD,qBAAqBC,eAArB,EAEA,GAAMzC,kBAAmBnG,uBAAuB4I,gBAAgBoB,aAAhB,EAAvB,CAAwDlL,SAAxD,CAAzB,CACA,GAAMa,WAAYiJ,gBAAgBqB,YAAhB,EAAlB,CACA,GAAMC,cAAexK,0BAA0BC,SAA1B,CAArB,CACA,GAAMqC,MAAO4G,gBAAgBuB,OAAhB,EAAb,CAEA,GAAItK,UAAJ,CACIY,qBADJ,CAGAZ,GAAKF,UAAYA,UAAUE,EAAtB,CAA2B,IAAhC,CACA,GAAIf,UAAUqB,MAAV,CAAmB,CAAvB,CAA0B,CACtBM,eAAiBZ,GAAKhB,kBAAkBuL,kBAAlB,CAAqCvK,EAArC,CAAyCf,UAAU,CAAV,EAAa8B,GAAb,CAAiBC,QAA1D,CAAoEsF,iBAAiBpG,KAArF,CAAL,CAAmGlB,kBAAkBwL,qBAAlB,CAAwC1K,UAAUI,KAAlD,CAAyDjB,UAAU,CAAV,EAAa8B,GAAb,CAAiBC,QAA1E,CAAoFsF,iBAAiBpG,KAArG,CAApH,CACA6I,gBAAgBK,2BAAhB,GAA8Cc,UAA9C,CAAyDtJ,cAAzD,CAAyEyJ,YAAzE,CAAuFlI,IAAvF,EACH,CACJ,CAED;;;;;OAMA,QAASsI,sBAAT,CAA+B/K,wBAA/B,CAAyDE,OAAzD,CAAkE,CAC9DoJ,8BAA8BtJ,wBAA9B,EACA,GAAIgB,wBAAJ,CAEA,GAAId,UAAYK,SAAhB,CAA2B,CACvB,kCAAaL,OAAb,EACAc,iBAAmBhB,yBAAyBC,2BAAzB,CAAqDC,OAArD,CAAnB,CACH,CAHD,IAGO,CACHc,iBAAmBhB,yBAAyBgL,wBAAzB,EAAnB,CACH,CAED,MAAOhK,kBAAmBD,0CAA0CC,gBAA1C,CAAnB,CAAiF,IAAxF,CACH,CAED,QAASiK,SAAT,CAAkBC,QAAlB,CAA4BC,YAA5B,CAA0CC,SAA1C,CAAqD,CACjD,GAAI,CAACF,QAAD,EAAa,CAACC,YAAlB,CAAgC,CAC5B,MAAO,KAAP,CACH,CACD,GAAME,OAAQ,GAAIC,gBAAJ,EAAd,CACA,GAAMhI,aAAc4H,SAASK,aAA7B,CACA,GAAMvI,OAAQkI,SAASlI,KAAvB,CACA,GAAMwI,WAAYN,SAASM,SAA3B,CACA,GAAMC,uBAAwBP,SAASQ,uBAAvC,CACA,GAAMxJ,UAAWgJ,SAASS,cAA1B,CACA,GAAMrL,IAAK4K,SAAS5K,EAApB,CACA,GAAMsL,aAAcV,SAASW,YAA7B,CACA,GAAMC,kBAAmBV,UAAYI,SAAZ,CAAwBC,qBAAjD,CAEA,GAAI,CAACN,aAAa7H,YAAc,GAAd,CAAoBN,KAAjC,CAAL,CAA8C,MAAO,KAAP,CAE9CqI,MAAMU,WAAN,CAAoBZ,aAAa7H,YAAc,GAAd,CAAoBN,KAAjC,CAApB,CACAqI,MAAMU,WAAN,CAAkB/I,KAAlB,CAA0BA,KAA1B,CACAqI,MAAMU,WAAN,CAAkBP,SAAlB,CAA8BA,SAA9B,CACAH,MAAMnJ,QAAN,CAAiBA,QAAjB,CACAmJ,MAAM/K,EAAN,CAAWA,EAAX,CACA+K,MAAMS,gBAAN,CAAyBA,gBAAzB,CACAT,MAAMO,WAAN,CAAoBA,WAApB,CACAP,MAAMI,qBAAN,CAA8BA,qBAA9B,CAEA,MAAOJ,MAAP,CACH,CAED,QAASW,aAAT,CAAsBC,IAAtB,CAA4B5C,eAA5B,CAA6C,CACzC,GAAI6C,QAAS,EAAb,CAEA,GAAI3M,UAAUqB,MAAV,GAAqB,CAAzB,CAA4B,CACxB,MAAOsL,OAAP,CACH,CAED,GAAM5K,UAAW/B,UAAU,CAAV,EAAa8B,GAAb,CAAiBC,QAAlC,CAEA,GAAI2K,eAAgB3G,qBAApB,CAAgC,CAC5B4G,OAAS5M,kBAAkB6M,kBAAlB,CAAqC1L,uBAAuBwL,IAAvB,CAA6B1M,SAA7B,CAArC,CAAT,CACH,CAFD,IAEO,IAAI0M,eAAgB1J,oBAApB,CAA+B,CAClC2J,OAAS5M,kBAAkB8M,8BAAlB,CAAiD9K,QAAjD,CAA2DnB,0BAA0B8L,IAA1B,CAA3D,CAAT,CACH,CAFM,IAEA,IAAIA,eAAgBhL,6BAApB,CAAwC,CAC3CiL,OAAS5M,kBAAkB+M,+BAAlB,CAAkD/K,QAAlD,CAA4DxB,uCAAuCmM,IAAvC,CAA6C5C,gBAAgBK,2BAAhB,EAA7C,CAA5D,CAAT,CACH,CAED,MAAOwC,OAAP,CACH,CAED,QAASI,oBAAT,CAA6BC,QAA7B,CAAuC9J,IAAvC,CAA6CrC,SAA7C,CAAwD,CACpDX,iBAAiB8M,QAAjB,EAA6B9M,iBAAiB8M,QAAjB,GAA8B,EAA3D,CACA9M,iBAAiB8M,QAAjB,EAA2B9J,IAA3B,EAAmChD,iBAAiB8M,QAAjB,EAA2B9J,IAA3B,GAAoC,EAAvE,CACAhD,iBAAiB8M,QAAjB,EAA2B9J,IAA3B,EAAmCrC,SAAnC,CACH,CAED,QAAST,MAAT,EAAiB,CACbJ,UAAY,EAAZ,CACAC,cAAgB,EAAhB,CACAC,iBAAmB,EAAnB,CACH,CAEDJ,SAAW,CACPmN,gCAAiCzL,yCAD1B,CAEP0L,gBAAiBtM,yBAFV,CAGP8I,eAAgBA,cAHT,CAIPvC,oBAAqBA,mBAJd,CAKPe,uBAAwBA,sBALjB,CAMPsD,sBAAuBA,qBANhB,CAOPpE,qBAAsBA,oBAPf,CAQP6D,WAAYA,UARL,CASPjB,eAAgBA,cATT,CAUPK,mBAAoBA,kBAVb,CAWPM,oBAAqBA,mBAXd,CAYPE,oBAAqBA,mBAZd,CAaP4B,aAAcA,YAbP,CAcPf,SAAUA,QAdH,CAePrL,UAAWA,SAfJ,CAgBPmJ,cAAeA,aAhBR,CAiBPpJ,MAAOA,KAjBA,CAkBP2K,kBAAmBA,iBAlBZ,CAmBPgC,oBAAqBA,mBAnBd,CAAX,CAsBA5M,QACA,MAAOL,SAAP,CACH,CAEDD,YAAYsN,qBAAZ,CAAoC,aAApC,C,gBACeC,uBAAaC,mBAAb,CAAiCxN,WAAjC,C","file":"DashAdapter.js","sourcesContent":["/**\n * The copyright in this software is being made available under the BSD License,\n * included below. This software may be subject to other third party and contributor\n * rights, including patent rights, and no such rights are granted under this license.\n *\n * Copyright (c) 2013, Dash Industry Forum.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without modification,\n * are permitted provided that the following conditions are met:\n *  * Redistributions of source code must retain the above copyright notice, this\n *  list of conditions and the following disclaimer.\n *  * Redistributions in binary form must reproduce the above copyright notice,\n *  this list of conditions and the following disclaimer in the documentation and/or\n *  other materials provided with the distribution.\n *  * Neither the name of Dash Industry Forum nor the names of its\n *  contributors may be used to endorse or promote products derived from this software\n *  without specific prior written permission.\n *\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n *  POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport Constants from '../streaming/constants/Constants';\nimport DashConstants from './constants/DashConstants';\nimport RepresentationInfo from '../streaming/vo/RepresentationInfo';\nimport MediaInfo from '../streaming/vo/MediaInfo';\nimport StreamInfo from '../streaming/vo/StreamInfo';\nimport ManifestInfo from '../streaming/vo/ManifestInfo';\nimport Event from './vo/Event';\nimport FactoryMaker from '../core/FactoryMaker';\nimport cea608parser from '../../externals/cea608-parser';\nimport { checkInteger } from '../streaming/utils/SupervisorTools';\n\nfunction DashAdapter() {\n    let instance,\n        dashManifestModel,\n        voPeriods,\n        voAdaptations,\n        currentMediaInfo;\n\n    function setup() {\n        reset();\n    }\n\n    function setConfig(config) {\n        if (!config) return;\n\n        if (config.dashManifestModel) {\n            dashManifestModel = config.dashManifestModel;\n        }\n    }\n\n    function getRepresentationForRepresentationInfo(representationInfo, representationController) {\n        return representationController && representationInfo ? representationController.getRepresentationForQuality(representationInfo.quality) : null;\n    }\n\n    function getAdaptationForMediaInfo(mediaInfo) {\n\n        if (!mediaInfo || !mediaInfo.streamInfo || mediaInfo.streamInfo.id === undefined || !voAdaptations[mediaInfo.streamInfo.id]) return null;\n        return voAdaptations[mediaInfo.streamInfo.id][mediaInfo.index];\n    }\n\n    function getPeriodForStreamInfo(streamInfo, voPeriodsArray) {\n        const ln = voPeriodsArray.length;\n\n        for (let i = 0; i < ln; i++) {\n            let voPeriod = voPeriodsArray[i];\n\n            if (streamInfo.id === voPeriod.id) return voPeriod;\n        }\n\n        return null;\n    }\n\n    function convertRepresentationToRepresentationInfo(voRepresentation) {\n        let representationInfo = new RepresentationInfo();\n        const realAdaptation = voRepresentation.adaptation.period.mpd.manifest.Period_asArray[voRepresentation.adaptation.period.index].AdaptationSet_asArray[voRepresentation.adaptation.index];\n        const realRepresentation = dashManifestModel.getRepresentationFor(voRepresentation.index, realAdaptation);\n\n        representationInfo.id = voRepresentation.id;\n        representationInfo.quality = voRepresentation.index;\n        representationInfo.bandwidth = dashManifestModel.getBandwidth(realRepresentation);\n        representationInfo.DVRWindow = voRepresentation.segmentAvailabilityRange;\n        representationInfo.fragmentDuration = voRepresentation.segmentDuration || (voRepresentation.segments && voRepresentation.segments.length > 0 ? voRepresentation.segments[0].duration : NaN);\n        representationInfo.MSETimeOffset = voRepresentation.MSETimeOffset;\n        representationInfo.useCalculatedLiveEdgeTime = voRepresentation.useCalculatedLiveEdgeTime;\n        representationInfo.mediaInfo = convertAdaptationToMediaInfo(voRepresentation.adaptation);\n\n        return representationInfo;\n    }\n\n    function convertAdaptationToMediaInfo(adaptation) {\n        let mediaInfo = new MediaInfo();\n        const realAdaptation = adaptation.period.mpd.manifest.Period_asArray[adaptation.period.index].AdaptationSet_asArray[adaptation.index];\n        let viewpoint;\n\n        mediaInfo.id = adaptation.id;\n        mediaInfo.index = adaptation.index;\n        mediaInfo.type = adaptation.type;\n        mediaInfo.streamInfo = convertPeriodToStreamInfo(adaptation.period);\n        mediaInfo.representationCount = dashManifestModel.getRepresentationCount(realAdaptation);\n        mediaInfo.lang = dashManifestModel.getLanguageForAdaptation(realAdaptation);\n        viewpoint = dashManifestModel.getViewpointForAdaptation(realAdaptation);\n        mediaInfo.viewpoint = viewpoint ? viewpoint.value : undefined;\n        mediaInfo.accessibility = dashManifestModel.getAccessibilityForAdaptation(realAdaptation).map(function (accessibility) {\n            let accessibilityValue = accessibility.value;\n            let accessibilityData = accessibilityValue;\n            if (accessibility.schemeIdUri && (accessibility.schemeIdUri.search('cea-608') >= 0) && typeof (cea608parser) !== 'undefined') {\n                if (accessibilityValue) {\n                    accessibilityData = 'cea-608:' + accessibilityValue;\n                } else {\n                    accessibilityData = 'cea-608';\n                }\n                mediaInfo.embeddedCaptions = true;\n            }\n            return accessibilityData;\n        });\n\n        mediaInfo.audioChannelConfiguration = dashManifestModel.getAudioChannelConfigurationForAdaptation(realAdaptation).map(function (audioChannelConfiguration) {\n            return audioChannelConfiguration.value;\n        });\n        mediaInfo.roles = dashManifestModel.getRolesForAdaptation(realAdaptation).map(function (role) {\n            return role.value;\n        });\n        mediaInfo.codec = dashManifestModel.getCodec(realAdaptation);\n        mediaInfo.mimeType = dashManifestModel.getMimeType(realAdaptation);\n        mediaInfo.contentProtection = dashManifestModel.getContentProtectionData(realAdaptation);\n        mediaInfo.bitrateList = dashManifestModel.getBitrateListForAdaptation(realAdaptation);\n\n        if (mediaInfo.contentProtection) {\n            mediaInfo.contentProtection.forEach(function (item) {\n                item.KID = dashManifestModel.getKID(item);\n            });\n        }\n\n        mediaInfo.isText = dashManifestModel.getIsTextTrack(mediaInfo.mimeType);\n\n        return mediaInfo;\n    }\n\n    function convertVideoInfoToEmbeddedTextInfo(mediaInfo, channel, lang) {\n        mediaInfo.id = channel; // CC1, CC2, CC3, or CC4\n        mediaInfo.index = 100 + parseInt(channel.substring(2, 3));\n        mediaInfo.type = Constants.EMBEDDED_TEXT;\n        mediaInfo.codec = 'cea-608-in-SEI';\n        mediaInfo.isText = true;\n        mediaInfo.isEmbedded = true;\n        mediaInfo.lang = lang;\n        mediaInfo.roles = ['caption'];\n    }\n\n    function convertVideoInfoToThumbnailInfo(mediaInfo) {\n        mediaInfo.type = Constants.IMAGE;\n    }\n\n    function convertPeriodToStreamInfo(period) {\n        let streamInfo = new StreamInfo();\n        const THRESHOLD = 1;\n\n        streamInfo.id = period.id;\n        streamInfo.index = period.index;\n        streamInfo.start = period.start;\n        streamInfo.duration = period.duration;\n        streamInfo.manifestInfo = convertMpdToManifestInfo(period.mpd);\n        streamInfo.isLast = period.mpd.manifest.Period_asArray.length === 1 || Math.abs((streamInfo.start + streamInfo.duration) - streamInfo.manifestInfo.duration) < THRESHOLD;\n\n        return streamInfo;\n    }\n\n    function convertMpdToManifestInfo(mpd) {\n        let manifestInfo = new ManifestInfo();\n\n        manifestInfo.DVRWindowSize = mpd.timeShiftBufferDepth;\n        manifestInfo.loadedTime = mpd.manifest.loadedTime;\n        manifestInfo.availableFrom = mpd.availabilityStartTime;\n        manifestInfo.minBufferTime = mpd.manifest.minBufferTime;\n        manifestInfo.maxFragmentDuration = mpd.maxSegmentDuration;\n        manifestInfo.duration = dashManifestModel.getDuration(mpd.manifest);\n        manifestInfo.isDynamic = dashManifestModel.getIsDynamic(mpd.manifest);\n\n        return manifestInfo;\n    }\n\n    function getMediaInfoForType(streamInfo, type) {\n\n        if (voPeriods.length === 0) {\n            return null;\n        }\n\n        const manifest = voPeriods[0].mpd.manifest;\n        let realAdaptation = getAdaptationForType(manifest, streamInfo.index, type, streamInfo);\n        if (!realAdaptation) return null;\n\n        let selectedVoPeriod = getPeriodForStreamInfo(streamInfo, voPeriods);\n        let periodId = selectedVoPeriod.id;\n        let idx = dashManifestModel.getIndexForAdaptation(realAdaptation, manifest, streamInfo.index);\n\n        voAdaptations[periodId] = voAdaptations[periodId] || dashManifestModel.getAdaptationsForPeriod(selectedVoPeriod);\n\n        return convertAdaptationToMediaInfo(voAdaptations[periodId][idx]);\n    }\n\n    function getIsMain(adaptation) {\n        return dashManifestModel.getRolesForAdaptation(adaptation).filter(function (role) {\n            return role.value === DashConstants.MAIN;\n        })[0];\n    }\n\n    function getAdaptationForType(manifest, periodIndex, type, streamInfo) {\n        const adaptations = dashManifestModel.getAdaptationsForType(manifest, periodIndex, type);\n\n        if (!adaptations || adaptations.length === 0) return null;\n\n        if (adaptations.length > 1 && streamInfo) {\n            const allMediaInfoForType = getAllMediaInfoForType(streamInfo, type);\n\n            if (currentMediaInfo[streamInfo.id] && currentMediaInfo[streamInfo.id][type]) {\n                for (let i = 0, ln = adaptations.length; i < ln; i++) {\n                    if (currentMediaInfo[streamInfo.id][type].isMediaInfoEqual(allMediaInfoForType[i])) {\n                        return adaptations[i];\n                    }\n                }\n            }\n\n            for (let i = 0, ln = adaptations.length; i < ln; i++) {\n                if (getIsMain(adaptations[i])) {\n                    return adaptations[i];\n                }\n            }\n        }\n\n        return adaptations[0];\n    }\n\n    function getAllMediaInfoForType(streamInfo, type, externalManifest) {\n        let voLocalPeriods = voPeriods;\n        let manifest = externalManifest;\n        let mediaArr = [];\n        let data,\n            media,\n            idx,\n            i,\n            j,\n            ln;\n\n        if (manifest) {\n            checkSetConfigCall();\n            const mpd = dashManifestModel.getMpd(manifest);\n\n            voLocalPeriods = dashManifestModel.getRegularPeriods(mpd);\n        } else {\n            if (voPeriods.length > 0) {\n                manifest = voPeriods[0].mpd.manifest;\n            } else {\n                return mediaArr;\n            }\n        }\n\n        const selectedVoPeriod = getPeriodForStreamInfo(streamInfo, voLocalPeriods);\n        const periodId = selectedVoPeriod.id;\n        const adaptationsForType = dashManifestModel.getAdaptationsForType(manifest, streamInfo.index, type !== Constants.EMBEDDED_TEXT ? type : Constants.VIDEO);\n\n        if (!adaptationsForType) return mediaArr;\n\n        voAdaptations[periodId] = voAdaptations[periodId] || dashManifestModel.getAdaptationsForPeriod(selectedVoPeriod);\n\n        for (i = 0, ln = adaptationsForType.length; i < ln; i++) {\n            data = adaptationsForType[i];\n            idx = dashManifestModel.getIndexForAdaptation(data, manifest, streamInfo.index);\n            media = convertAdaptationToMediaInfo(voAdaptations[periodId][idx]);\n\n            if (type === Constants.EMBEDDED_TEXT) {\n                let accessibilityLength = media.accessibility.length;\n                for (j = 0; j < accessibilityLength; j++) {\n                    if (!media) {\n                        continue;\n                    }\n                    let accessibility = media.accessibility[j];\n                    if (accessibility.indexOf('cea-608:') === 0) {\n                        let value = accessibility.substring(8);\n                        let parts = value.split(';');\n                        if (parts[0].substring(0, 2) === 'CC') {\n                            for (j = 0; j < parts.length; j++) {\n                                if (!media) {\n                                    media = convertAdaptationToMediaInfo.call(this, voAdaptations[periodId][idx]);\n                                }\n                                convertVideoInfoToEmbeddedTextInfo(media, parts[j].substring(0, 3), parts[j].substring(4));\n                                mediaArr.push(media);\n                                media = null;\n                            }\n                        } else {\n                            for (j = 0; j < parts.length; j++) { // Only languages for CC1, CC2, ...\n                                if (!media) {\n                                    media = convertAdaptationToMediaInfo.call(this, voAdaptations[periodId][idx]);\n                                }\n                                convertVideoInfoToEmbeddedTextInfo(media, 'CC' + (j + 1), parts[j]);\n                                mediaArr.push(media);\n                                media = null;\n                            }\n                        }\n                    } else if (accessibility.indexOf('cea-608') === 0) { // Nothing known. We interpret it as CC1=eng\n                        convertVideoInfoToEmbeddedTextInfo(media, Constants.CC1, 'eng');\n                        mediaArr.push(media);\n                        media = null;\n                    }\n                }\n            } else if (type === Constants.IMAGE) {\n                convertVideoInfoToThumbnailInfo(media);\n                mediaArr.push(media);\n                media = null;\n            } else if (media) {\n                mediaArr.push(media);\n            }\n        }\n\n        return mediaArr;\n    }\n\n    function checkSetConfigCall() {\n        if (!dashManifestModel || !dashManifestModel.hasOwnProperty('getMpd') || !dashManifestModel.hasOwnProperty('getRegularPeriods')) {\n            throw new Error('setConfig function has to be called previously');\n        }\n    }\n\n    function updatePeriods(newManifest) {\n        if (!newManifest) return null;\n\n        checkSetConfigCall();\n\n        const mpd = dashManifestModel.getMpd(newManifest);\n\n        voPeriods = dashManifestModel.getRegularPeriods(mpd);\n        voAdaptations = {};\n    }\n\n    function getStreamsInfo(externalManifest, maxStreamsInfo) {\n        const streams = [];\n        let voLocalPeriods = voPeriods;\n\n        //if manifest is defined, getStreamsInfo is for an outside manifest, not the current one\n        if (externalManifest) {\n            checkSetConfigCall();\n            const mpd = dashManifestModel.getMpd(externalManifest);\n\n            voLocalPeriods = dashManifestModel.getRegularPeriods(mpd);\n        }\n\n        if (!maxStreamsInfo) {\n            maxStreamsInfo = voLocalPeriods.length;\n        }\n        for (let i = 0; i < maxStreamsInfo; i++) {\n            streams.push(convertPeriodToStreamInfo(voLocalPeriods[i]));\n        }\n\n        return streams;\n    }\n\n    function checkStreamProcessor(streamProcessor) {\n        if (!streamProcessor || !streamProcessor.hasOwnProperty('getRepresentationController') || !streamProcessor.hasOwnProperty('getIndexHandler') ||\n            !streamProcessor.hasOwnProperty('getMediaInfo') || !streamProcessor.hasOwnProperty('getType') || !streamProcessor.hasOwnProperty('getStreamInfo')) {\n            throw new Error('streamProcessor parameter is missing or malformed!');\n        }\n    }\n\n    function checkRepresentationController(representationController) {\n        if (!representationController || !representationController.hasOwnProperty('getRepresentationForQuality') || !representationController.hasOwnProperty('getCurrentRepresentation')) {\n            throw new Error('representationController parameter is missing or malformed!');\n        }\n    }\n\n    function getInitRequest(streamProcessor, quality) {\n        let representationController,\n            representation,\n            indexHandler;\n\n        checkStreamProcessor(streamProcessor);\n        checkInteger(quality);\n\n        representationController = streamProcessor.getRepresentationController();\n        indexHandler = streamProcessor.getIndexHandler();\n\n        representation = representationController ? representationController.getRepresentationForQuality(quality) : null;\n\n        return indexHandler ? indexHandler.getInitRequest(representation) : null;\n    }\n\n    function getFragmentRequest(streamProcessor, representationInfo, time, options) {\n        let representationController,\n            representation,\n            indexHandler;\n\n        let fragRequest = null;\n\n        checkStreamProcessor(streamProcessor);\n\n        representationController = streamProcessor.getRepresentationController();\n        representation = getRepresentationForRepresentationInfo(representationInfo, representationController);\n        indexHandler = streamProcessor.getIndexHandler();\n\n        if (indexHandler) {\n            //if time and options are undefined, it means the next segment is requested\n            //otherwise, the segment at this specific time is requested.\n            if (time !== undefined && options !== undefined) {\n                fragRequest = indexHandler.getSegmentRequestForTime(representation, time, options);\n            } else {\n                fragRequest = indexHandler.getNextSegmentRequest(representation);\n            }\n        }\n\n        return fragRequest;\n    }\n\n    function getIndexHandlerTime(streamProcessor) {\n        checkStreamProcessor(streamProcessor);\n\n        const indexHandler = streamProcessor.getIndexHandler();\n\n        return indexHandler ? indexHandler.getCurrentTime() : NaN;\n    }\n\n    function setIndexHandlerTime(streamProcessor, value) {\n        checkStreamProcessor(streamProcessor);\n\n        const indexHandler = streamProcessor.getIndexHandler();\n        if (indexHandler) {\n            indexHandler.setCurrentTime(value);\n        }\n    }\n\n    function resetIndexHandler(streamProcessor) {\n        checkStreamProcessor(streamProcessor);\n\n        const indexHandler = streamProcessor.getIndexHandler();\n        if (indexHandler) {\n            indexHandler.resetIndex();\n        }\n    }\n\n    function updateData(streamProcessor) {\n        checkStreamProcessor(streamProcessor);\n\n        const selectedVoPeriod = getPeriodForStreamInfo(streamProcessor.getStreamInfo(), voPeriods);\n        const mediaInfo = streamProcessor.getMediaInfo();\n        const voAdaptation = getAdaptationForMediaInfo(mediaInfo);\n        const type = streamProcessor.getType();\n\n        let id,\n            realAdaptation;\n\n        id = mediaInfo ? mediaInfo.id : null;\n        if (voPeriods.length > 0) {\n            realAdaptation = id ? dashManifestModel.getAdaptationForId(id, voPeriods[0].mpd.manifest, selectedVoPeriod.index) : dashManifestModel.getAdaptationForIndex(mediaInfo.index, voPeriods[0].mpd.manifest, selectedVoPeriod.index);\n            streamProcessor.getRepresentationController().updateData(realAdaptation, voAdaptation, type);\n        }\n    }\n\n    /**\n     * Get a specific voRepresentation. If quality parameter is defined, this function will return the voRepresentation for this quality.\n     * Otherwise, this function will return the current voRepresentation used by the representationController.\n     * @param {RepresentationController} representationController - RepresentationController reference\n     * @param {number} quality - quality index of the voRepresentaion expected.\n     */\n    function getRepresentationInfo(representationController, quality) {\n        checkRepresentationController(representationController);\n        let voRepresentation;\n\n        if (quality !== undefined) {\n            checkInteger(quality);\n            voRepresentation = representationController.getRepresentationForQuality(quality);\n        } else {\n            voRepresentation = representationController.getCurrentRepresentation();\n        }\n\n        return voRepresentation ? convertRepresentationToRepresentationInfo(voRepresentation) : null;\n    }\n\n    function getEvent(eventBox, eventStreams, startTime) {\n        if (!eventBox || !eventStreams) {\n            return null;\n        }\n        const event = new Event();\n        const schemeIdUri = eventBox.scheme_id_uri;\n        const value = eventBox.value;\n        const timescale = eventBox.timescale;\n        const presentationTimeDelta = eventBox.presentation_time_delta;\n        const duration = eventBox.event_duration;\n        const id = eventBox.id;\n        const messageData = eventBox.message_data;\n        const presentationTime = startTime * timescale + presentationTimeDelta;\n\n        if (!eventStreams[schemeIdUri + '/' + value]) return null;\n\n        event.eventStream = eventStreams[schemeIdUri + '/' + value];\n        event.eventStream.value = value;\n        event.eventStream.timescale = timescale;\n        event.duration = duration;\n        event.id = id;\n        event.presentationTime = presentationTime;\n        event.messageData = messageData;\n        event.presentationTimeDelta = presentationTimeDelta;\n\n        return event;\n    }\n\n    function getEventsFor(info, streamProcessor) {\n        let events = [];\n\n        if (voPeriods.length === 0) {\n            return events;\n        }\n\n        const manifest = voPeriods[0].mpd.manifest;\n\n        if (info instanceof StreamInfo) {\n            events = dashManifestModel.getEventsForPeriod(getPeriodForStreamInfo(info, voPeriods));\n        } else if (info instanceof MediaInfo) {\n            events = dashManifestModel.getEventStreamForAdaptationSet(manifest, getAdaptationForMediaInfo(info));\n        } else if (info instanceof RepresentationInfo) {\n            events = dashManifestModel.getEventStreamForRepresentation(manifest, getRepresentationForRepresentationInfo(info, streamProcessor.getRepresentationController()));\n        }\n\n        return events;\n    }\n\n    function setCurrentMediaInfo(streamId, type, mediaInfo) {\n        currentMediaInfo[streamId] = currentMediaInfo[streamId] || {};\n        currentMediaInfo[streamId][type] = currentMediaInfo[streamId][type] || {};\n        currentMediaInfo[streamId][type] = mediaInfo;\n    }\n\n    function reset() {\n        voPeriods = [];\n        voAdaptations = {};\n        currentMediaInfo = {};\n    }\n\n    instance = {\n        convertDataToRepresentationInfo: convertRepresentationToRepresentationInfo,\n        getDataForMedia: getAdaptationForMediaInfo,\n        getStreamsInfo: getStreamsInfo,\n        getMediaInfoForType: getMediaInfoForType,\n        getAllMediaInfoForType: getAllMediaInfoForType,\n        getRepresentationInfo: getRepresentationInfo,\n        getAdaptationForType: getAdaptationForType,\n        updateData: updateData,\n        getInitRequest: getInitRequest,\n        getFragmentRequest: getFragmentRequest,\n        getIndexHandlerTime: getIndexHandlerTime,\n        setIndexHandlerTime: setIndexHandlerTime,\n        getEventsFor: getEventsFor,\n        getEvent: getEvent,\n        setConfig: setConfig,\n        updatePeriods: updatePeriods,\n        reset: reset,\n        resetIndexHandler: resetIndexHandler,\n        setCurrentMediaInfo: setCurrentMediaInfo\n    };\n\n    setup();\n    return instance;\n}\n\nDashAdapter.__dashjs_factory_name = 'DashAdapter';\nexport default FactoryMaker.getSingletonFactory(DashAdapter);\n"]}